<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="openpilot docs" name="description" />
<meta content="op, openpilot, docs, documentation" name="keywords" />
<meta content="all,follow" name="robots" />
<meta content="index,follow,snippet,archive" name="googlebot" />
<meta content="en_US" property="og:locale" />
<meta content="docs.comma.ai" property="og:site_name" />
<meta content="https://docs.comma.ai" property="og:url" />
<meta content="openpilot Documentation" property="og:title" />
<meta content="website" property="og:type" />
<meta content="image/jpeg" property="og:image:type" />
<meta content="400" property="og:image:width" />
<meta content="https://docs.comma.ai/_static/logo.png" property="og:image" />
<meta content="https://docs.comma.ai/_static/logo.png" property="og:image:url" />
<meta content="https://docs.comma.ai/_static/logo.png" property="og:image:secure_url" />
<meta content="openpilot Documentation" property="og:description" />
<meta content="summary_large_image" property="twitter:card" />
<meta content="https://docs.comma.ai/_static/logo.png" property="twitter:logo" />
<meta content="openpilot Documentation" property="twitter:title" />
<meta content="openpilot Documentation" property="twitter:description" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Windows driver &mdash; openpilot docs 0.9.5 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.comma.ai/panda/drivers/windows/README.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=61b282d3"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Introduction" href="../../../rednose_repo/README.html" />
    <link rel="prev" title="Linux driver" href="../linux/README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #000000" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            openpilot docs
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.9.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CARS.html">Supported Cars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CARS.html#id1">265 Supported Cars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CARS.html#don-t-see-your-car-here">Don’t see your car here?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION.html">Integration with Stock Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LIMITATIONS.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../SAFETY.html">Safety</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">openpilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#cereal">cereal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#laika">laika</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#models">models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#opendbc">opendbc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../overview.html#panda">panda</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../README.html">Welcome to panda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../board/README.html">Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../board/README.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/README.html">Linux driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Windows driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-j2534-driver">Installing J2534 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-winusb-driver">Installing WinUSB driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-j2534">Using J2534</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-j2534">What is J2534?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-use-j2534-with-the-panda">Why use J2534 with the panda?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-parts-are-supported-with-panda">What parts are supported with panda?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-project">Building the Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developing">Developing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#todo-items">ToDo Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#rednose">rednose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html#tools">tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">openpilot</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C/C++ API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../c_docs.html">openpilot</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #000000" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">openpilot docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../overview.html">openpilot</a></li>
      <li class="breadcrumb-item active">Windows driver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/panda/drivers/windows/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="windows-driver">
<h1>Windows driver<a class="headerlink" href="#windows-driver" title="Link to this heading"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                                                                                        ;&quot;   ^;     ;&#39;   &quot;,
______/\\\\\\\\\\\____/\\\\\\\\\_______/\\\\\\\\\\\\\\\______/\\\\\\\\\\_____________/\\\____           ;    s$$$$$$$s     ;
 _____\/////\\\///___/\\\///////\\\____\/\\\///////////_____/\\\///////\\\__________/\\\\\____          ,  ss$$$$$$$$$$s  ,&#39;
  _________\/\\\_____\///______\//\\\___\/\\\_______________\///______/\\\_________/\\\/\\\____         ;s$$$$$$$$$$$$$$$
   _________\/\\\_______________/\\\/____\/\\\\\\\\\\\\_____________/\\\//________/\\\/\/\\\____        $$$$$$$$$$$$$$$$$$
    _________\/\\\____________/\\\//______\////////////\\\__________\////\\\_____/\\\/__\/\\\____      $$$$P&quot;&quot;Y$$$Y&quot;&quot;W$$$$$
     _________\/\\\_________/\\\//____________________\//\\\____________\//\\\__/\\\\\\\\\\\\\\\\_     $$$$  p&quot;$$$&quot;q  $$$$$
      __/\\\___\/\\\_______/\\\/____________/\\\________\/\\\___/\\\______/\\\__\///////////\\\//__    $$$$  .$$$$$.  $$$$
       _\//\\\\\\\\\_______/\\\\\\\\\\\\\\\_\//\\\\\\\\\\\\\/___\///\\\\\\\\\/_____________\/\\\____  _ $$$$$$$$$$$$$$$$
        __\/////////_______\///////////////___\/////////////_______\/////////_______________\///_____| |  &quot;Y$$$&quot;*&quot;$$$Y&quot;
                                                                                _ __   __ _ _ __   __| | __ _&quot;$b.$$&quot;
                                                                               | &#39;_ \ / _` | &#39;_ \ / _` |/ _` |
                                                                               | |_) | (_| | | | | (_| | (_| |
                                                                               | .__/ \__,_|_| |_|\__,_|\__,_|
                                                                               | |     A comma.ai product.
                                                                               |_| (Code by Jessy Diamond Exum)
</pre></div>
</div>
<section id="installing-j2534-driver">
<h2>Installing J2534 driver<a class="headerlink" href="#installing-j2534-driver" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/commaai/panda/files/4844692/panda.J2534.driver.install.zip">Download</a></p>
<p>Depending on what version of windows you are on, you may need to separately install the WinUSB driver (see next section).</p>
</section>
<section id="installing-winusb-driver">
<h2>Installing WinUSB driver<a class="headerlink" href="#installing-winusb-driver" title="Link to this heading"></a></h2>
<p>Installation automatically happens for Windows 8 and Windows 10 because the panda
firmware contains the USB descriptors necessary to auto-install the WinUSB driver.</p>
<p>Windows 7 will not auto-install the WinUSB driver. You can use Zadig to install
the WinUSB driver. This software is not tested on anything before 7.</p>
<p>More details here:
<a class="reference external" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/winusb-installation">WinUSB (Winusb.sys) Installation</a>
<a class="reference external" href="https://github.com/pbatard/libwdi/wiki/WCID-Devices">WCID Devices</a>
<a class="reference external" href="https://github.com/pbatard/libwdi/wiki/Zadig">Zadig for installing libusb compatible driver</a></p>
</section>
<section id="using-j2534">
<h2>Using J2534<a class="headerlink" href="#using-j2534" title="Link to this heading"></a></h2>
<p>After installing the J2534 drivers for the panda, you can do… nothing.
You first need to get a J2534 client that can load the drivers and talk to
the panda for you.</p>
<p>A simple tool for testing J2534 drivers is DrewTech’s ‘J2534-1 Bus Analysis
Tool’ available in the ‘Other Support Applications’ section of their
<a class="reference external" href="http://www.drewtech.com/downloads/#OtherSupportApplications">Download Page</a>.</p>
</section>
<section id="what-is-j2534">
<h2>What is J2534?<a class="headerlink" href="#what-is-j2534" title="Link to this heading"></a></h2>
<p>J2534 is an API that tries to provide a consistent way to send/receive
messages over the many different protocols supported by the OBD II
port. The place this is perhaps most obvious, is sending data over
different protocols (each using unique packetizing methods) using the
same data format.</p>
<p>For each PassThru Device that should be used with J2534 (in this case,
the panda), a ‘driver’ has to be written that can be loaded by a
client application wanting to send/receive data.</p>
<p>A lot of J2534 has good ideas behind it, but the standard has some odd choices:</p>
<ul class="simple">
<li><p>Platform Locked: Requires using the Windows Registry to find installed J2534 libraries/drivers. Drivers have to be DLLs.</p></li>
<li><p>Architecture Locked: So far there is only support for x86.</p></li>
<li><p>No device autodetect, and poor support for selecting from multiple devices.</p></li>
<li><p>Constant vague language about important behavior (small differences between vendors).</p></li>
<li><p>Most common differences become standard in later revisions.</p></li>
</ul>
</section>
<section id="why-use-j2534-with-the-panda">
<h2>Why use J2534 with the panda?<a class="headerlink" href="#why-use-j2534-with-the-panda" title="Link to this heading"></a></h2>
<p>J2534 is the only interface supported by most professional grade
vehicle diagnostics systems (such as HDS). These tools are useful for
diagnosing vehicles, as well as reverse engineering some lesser known
features.</p>
</section>
<section id="what-parts-are-supported-with-panda">
<h2>What parts are supported with panda?<a class="headerlink" href="#what-parts-are-supported-with-panda" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>[ ] <strong>J1850VPW</strong> <em>(Outdated, and not physically supported by the panda)</em></p></li>
<li><p>[ ] <strong>J1850PWM</strong> <em>(Outdated, and not physically supported by the panda)</em></p></li>
<li><p>[X] <strong>CAN</strong></p></li>
<li><p>[X] <strong>ISO15765</strong></p></li>
<li><p>[X] <strong>ISO9141</strong></p></li>
<li><p>[X] <strong>ISO14230/KWP2000</strong></p></li>
</ul>
</section>
<section id="building-the-project">
<h2>Building the Project<a class="headerlink" href="#building-the-project" title="Link to this heading"></a></h2>
<p>This project is developed with Visual Studio 2017, the Windows SDK,
and the Windows Driver Kit (WDK).</p>
<p>The WDK is only required for creating the signed WinUSB inf file. The
WDK may also provide the headers for WinUSB.</p>
<p>To build all the projects required for the installer, in Visual
Studio, select <strong>Build-&gt;Batch Build.</strong> In the project list select:</p>
<ul class="simple">
<li><p><strong>“panda”</strong> <em>Release|x86</em></p></li>
<li><p><strong>“panda”</strong> <em>Release|x64</em></p></li>
<li><p><strong>“panda Driver Package”</strong> Debug|x86 (Note this inf file works with x86/amd64).</p></li>
<li><p><strong>“pandaJ2534DLL”</strong> <em>Release|x86</em></p></li>
</ul>
<p>The installer is generated with <a class="reference external" href="http://nsis.sourceforge.net/Main_Page">NullSoft NSIS</a>.
Use NSIS to run panda_install.nsi after building all the required projects.</p>
<p>Before generating the installer, you must go to copy vscruntimeinfo.nsh.sample to
vscruntimeinfo.nsh and follow the instructions to bundle in the Visual Studio C
Runtime required by your version of Visual Studio. Without this runtime, the panda
code will not work, so without this file, the installer will refuse to build.</p>
</section>
<section id="developing">
<h2>Developing<a class="headerlink" href="#developing" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Edit and merge pandaJ2534DLL\J2534register_x64.reg to register your development J2534 DLL.</p></li>
<li><p>Add your output directory (panda\drivers\windows\Debug_x86) to your system PATH to avoid insanity.</p></li>
</ul>
</section>
<section id="todo-items">
<h2>ToDo Items<a class="headerlink" href="#todo-items" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Apply a style-guide and consistent naming convention for Classes/Functions/Variables.</p></li>
<li><p>Send multiple messages (each with a different address) from a given connection at the same time.</p></li>
<li><p>Find more documentation about SW_CAN_PS (Single Wire CAN, aka GMLAN).</p></li>
<li><p>Find example of client using a _PS version of a protocol (PS is pin select, and may support using different CAN buses).</p></li>
</ul>
</section>
<section id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>ISO15765 Multi-frame TX: Hardware delays make transmission overshoot
STMIN by several milliseconds. This does not violate the requirements
of STMIN, it just means it is a little slower than it could be.</p></li>
<li><p>All Tx messages from a single Connection are serialized. This can be
relaxed to allow serialization of messages based on their address
(making multiple queues, effectively one queue per address).</p></li>
</ul>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<p>troubleshooting:</p>
<ol class="arabic simple">
<li><p>Install DrewTech J2534-1 Bus Analysis Tool
http://www.drewtech.com/downloads/tools/Drew%20Technologies%20Tool%20for%20J2534-1%20API%20v1.07.msi</p></li>
<li><p>Open DrewTech tool and make sure it shows “panda” as a device listed (this means registry settings are correct)</p></li>
<li><p>When DrewTech tool attempts to load the driver it will show an error if it fails</p></li>
<li><p>To figure out why the driver fails to load install Process Monitor and filter by the appropriate process name
https://docs.microsoft.com/en-us/sysinternals/downloads/procmon</p></li>
</ol>
</section>
<section id="other">
<h2>Other<a class="headerlink" href="#other" title="Link to this heading"></a></h2>
<p>Panda head ASCII art by dcau</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../linux/README.html" class="btn btn-neutral float-left" title="Linux driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../rednose_repo/README.html" class="btn btn-neutral float-right" title="Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, comma.ai.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>